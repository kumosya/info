#ifndef LIBCPP_CSTDARG_H
#define LIBCPP_CSTDARG_H

/* Minimal <cstdarg> for freestanding x86_64 kernel build.
   This header includes the C <stdarg.h> macros (va_start, va_arg, va_end,
   va_copy) in the global namespace and exposes the va_list type inside
   namespace std.
   Note: va_start/va_arg/va_end are macros and must be used from the
   global namespace (you cannot wrap them in functions). */

#include <stdarg.h>

#ifdef __cplusplus
namespace std {

typedef ::va_list va_list;

/* Provide a small std::va_copy wrapper function so C++ code can call
   std::va_copy(dest, src). Only provide this function when the C
   macro `va_copy` is not present to avoid macro/name collisions. If
   the C macro exists, it can be used from the global namespace. */
#ifndef va_copy
inline void va_copy(va_list &dest, va_list src) noexcept {
   __builtin_va_copy(dest, src);
}
#endif

} // namespace std
#endif /* __cplusplus */

#endif /* LIBCPP_CSTDARG_H */
